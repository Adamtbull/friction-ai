<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Friction AI - Family OS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    /* --- CORE THEME --- */
    :root {
      --primary: #0f172a;
      --bg: #f8fafc;
      --household: #4f9d9a;
      --adult: #3b82f6;
      --child: #f59e0b;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: #1e293b;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden; /* Prevent body scroll, we scroll internal elements */
    }

    /* --- BUBBLE NAV (Horizontal Scroll) --- */
    .bubble-container {
      background: white;
      padding: 16px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      z-index: 10;
    }

    .bubble-row {
      display: flex;
      gap: 24px;
      overflow-x: auto;
      padding: 10px 24px;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE */
    }
    .bubble-row::-webkit-scrollbar { display: none; } /* Chrome/Safari */

    .bubble-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      flex-shrink: 0;
    }

    .bubble {
      width: 68px;
      height: 68px;
      border-radius: 50%;
      background: #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      border: 3px solid transparent;
      transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      cursor: pointer;
      user-select: none; /* Important for long press */
      -webkit-user-select: none;
      touch-action: manipulation;
    }

    /* Active/Pressed State for Feedback */
    .bubble.pressing { transform: scale(0.92); }
    .bubble.selected { transform: scale(1.1); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }

    .bubble.type-adult { border-color: var(--adult); color: var(--adult); background: #eff6ff; }
    .bubble.type-child { border-color: var(--child); color: var(--child); background: #fffbeb; }
    .bubble.type-household { border-color: var(--household); color: var(--household); background: #f0fdfa; }

    .bubble-label {
      margin-top: 8px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #64748b;
    }

    /* --- POP-OUT MENU (Long Press) --- */
    .action-menu {
      position: absolute;
      top: 85px;
      left: 50%;
      transform: translateX(-50%) scale(0.95);
      background: white;
      border-radius: 12px;
      width: 180px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: all 0.2s ease;
    }

    .action-menu.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateX(-50%) scale(1);
    }

    .menu-item {
      padding: 12px;
      font-size: 0.9rem;
      color: #334155;
      background: none;
      border: none;
      text-align: left;
      border-radius: 8px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .menu-item:active { background: #f1f5f9; }

    /* --- FEED LAYER (Scrollable) --- */
    .feed-layer {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      background: var(--bg);
    }

    .feed-header {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #94a3b8;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .feed-card {
      background: white;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
      border-left: 5px solid #e2e8f0;
      animation: slideUp 0.3s ease-out;
    }

    .card-pinned { border-left-color: var(--primary); background: #f8fafc; border: 1px solid #e2e8f0; }
    .card-roster { border-left-color: var(--adult); }
    .card-milestone { border-left-color: var(--child); }
    
    .card-title { font-weight: 600; font-size: 1rem; margin-bottom: 6px; color: #0f172a; }
    .card-body { font-size: 0.95rem; color: #475569; line-height: 1.5; }

    /* --- FAB (Floating Action Button) --- */
    .fab {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: 0 4px 15px rgba(15, 23, 42, 0.4);
      cursor: pointer;
      z-index: 200;
    }

    /* --- MODAL (For Profile Tap) --- */
    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5); 
      z-index: 900; display: none; opacity: 0; transition: opacity 0.2s;
    }
    .modal-overlay.open { display: block; opacity: 1; }
    
    .bottom-sheet {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: white; border-radius: 20px 20px 0 0;
      padding: 24px; z-index: 1000;
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .bottom-sheet.open { transform: translateY(0); }

    @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <div class="bubble-container">
    <div class="bubble-row" id="bubbleRow">
      </div>
  </div>

  <div class="feed-layer" id="feedLayer">
    <div class="feed-header">Current Focus</div>
    
    <div class="feed-card card-pinned">
      <div class="card-title">ðŸ“Œ Weekly AI Summary</div>
      <div class="card-body">
        â€¢ <b>Roster:</b> Overlap on Tuesday PM.<br>
        â€¢ <b>Health:</b> Confirm Heparin competency.<br>
        â€¢ <b>Tasks:</b> 3 high priority items pending.
      </div>
    </div>

    <div class="feed-card card-roster">
      <div class="card-title">ðŸ“‹ Roster Imported</div>
      <div class="card-body">Shift added for Monday 0700-1530 (Ward 2B).</div>
    </div>
  </div>

  <div class="fab" onclick="alert('Quick Add Global Item')">+</div>

  <div class="modal-overlay" id="modalOverlay" onclick="closeProfile()"></div>
  <div class="bottom-sheet" id="profileSheet">
    <h2 id="profileTitle" style="margin-top:0">Profile</h2>
    <p>Profile details and history would appear here.</p>
    <button onclick="closeProfile()" style="width:100%; padding:12px; background:#f1f5f9; border:none; border-radius:8px;">Close</button>
  </div>

  <script>
    // --- DATA MODEL ---
    const familyMembers = [
      { id: 'me', name: 'Me', role: 'adult', icon: 'ðŸ‘¨â€âš•ï¸' },
      { id: 'wife', name: 'Wife', role: 'adult', icon: 'ðŸ‘©' },
      { id: 'bubby', name: 'Bubby', role: 'child', icon: 'ðŸ‘¶' },
      { id: 'house', name: 'Home', role: 'household', icon: 'ðŸ ' }
    ];

    const menuOptions = {
      adult: [
        { label: 'Add Appointment', icon: 'ðŸ©º' },
        { label: 'Add Roster', icon: 'ðŸ“‹' },
        { label: 'Add Event', icon: 'ðŸŽ‰' },
        { label: 'Add Goal', icon: 'ðŸŽ¯' },
        { label: 'Add Note', icon: 'ðŸ“' },
        { label: 'Share Task', icon: 'ðŸ¤' }
      ],
      child: [
        { label: 'Add Appointment', icon: 'ðŸ©º' },
        { label: 'Add Milestone', icon: 'â­' },
        { label: 'Add Event', icon: 'ðŸŽ‰' },
        { label: 'Add Goal', icon: 'ðŸŽ¯' },
        { label: 'Add Photo/Note', icon: 'ðŸ“¸' }
      ],
      household: [
        { label: 'Shared Task', icon: 'ðŸ“¦' },
        { label: 'Shared Event', icon: 'ðŸŽ‰' },
        { label: 'Weekly Plan', icon: 'ðŸ“' }
      ]
    };

    // --- RENDER BUBBLES ---
    const bubbleRow = document.getElementById('bubbleRow');
    
    familyMembers.forEach(member => {
      const wrapper = document.createElement('div');
      wrapper.className = 'bubble-wrapper';
      
      // Bubble
      const bubble = document.createElement('div');
      bubble.className = `bubble type-${member.role}`;
      bubble.innerHTML = member.icon;
      bubble.dataset.id = member.id;
      bubble.dataset.role = member.role;
      
      // Label
      const label = document.createElement('div');
      label.className = 'bubble-label';
      label.textContent = member.name;

      // Menu (Hidden)
      const menu = document.createElement('div');
      menu.className = 'action-menu';
      menu.id = `menu-${member.id}`;
      
      // Populate Menu Items
      const options = menuOptions[member.role] || menuOptions.adult;
      options.forEach(opt => {
        const btn = document.createElement('button');
        btn.className = 'menu-item';
        btn.innerHTML = `<span>${opt.icon}</span> ${opt.label}`;
        btn.onclick = () => handleMenuAction(member.name, opt.label);
        menu.appendChild(btn);
      });

      wrapper.appendChild(bubble);
      wrapper.appendChild(label);
      wrapper.appendChild(menu);
      bubbleRow.appendChild(wrapper);

      // Attach Touch Logic
      attachInteraction(bubble, member);
    });

    // --- INTERACTION LOGIC (The "Physics") ---
    function attachInteraction(element, member) {
      let pressTimer;
      let isLongPress = false;

      // START (Touch or Mouse)
      const startPress = (e) => {
        // Prevent default only on touch to stop scrolling while holding? 
        // Actually, we want to allow scrolling if they drag.
        
        isLongPress = false;
        element.classList.add('pressing');
        
        pressTimer = setTimeout(() => {
          isLongPress = true;
          element.classList.remove('pressing');
          openMenu(member.id);
          // Vibrate if supported
          if (navigator.vibrate) navigator.vibrate(50); 
        }, 400); // 400ms Threshold
      };

      // END (Touch or Mouse)
      const endPress = (e) => {
        clearTimeout(pressTimer);
        element.classList.remove('pressing');
        
        if (!isLongPress) {
          // If it wasn't a long press, treat as Tap
          // But check if they scrolled/dragged away? (Simple version for now)
          openProfile(member);
        }
      };

      // CANCEL (If they scroll away)
      const cancelPress = () => {
        clearTimeout(pressTimer);
        element.classList.remove('pressing');
      };

      element.addEventListener('touchstart', startPress, { passive: true });
      element.addEventListener('touchend', endPress);
      element.addEventListener('touchmove', cancelPress);
      
      element.addEventListener('mousedown', startPress);
      element.addEventListener('mouseup', endPress);
      element.addEventListener('mouseleave', cancelPress);
    }

    // --- UI ACTIONS ---
    function openMenu(memberId) {
      // Close all others
      document.querySelectorAll('.action-menu').forEach(el => el.classList.remove('visible'));
      
      const menu = document.getElementById(`menu-${memberId}`);
      if (menu) menu.classList.add('visible');
    }

    function openProfile(member) {
      // Close menus first
      document.querySelectorAll('.action-menu').forEach(el => el.classList.remove('visible'));
      
      document.getElementById('profileTitle').textContent = `${member.name}'s Profile`;
      document.getElementById('modalOverlay').classList.add('open');
      document.getElementById('profileSheet').classList.add('open');
    }

    function closeProfile() {
      document.getElementById('modalOverlay').classList.remove('open');
      document.getElementById('profileSheet').classList.remove('open');
    }

    function handleMenuAction(who, action) {
      document.querySelectorAll('.action-menu').forEach(el => el.classList.remove('visible'));
      alert(`Action: ${action} for ${who}`);
      // Phase 2 will replace this alert with the Input Card
    }

    // Close menus on background tap
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.bubble-wrapper')) {
        document.querySelectorAll('.action-menu').forEach(el => el.classList.remove('visible'));
      }
    });

  </script>
</body>
</html>
